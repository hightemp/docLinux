# Как очистить своп при наличии свободной оперативной памяти?

Вы также можете установить значение «swappiness» по умолчанию, равное 60, таким образом, своп не будет увеличиваться с самого начала. Почему доставка по умолчанию установлена на 60, когда рекомендуемое значение 10 озадачивает меня. [From the Ubuntu SwapFAQ](https://help.ubuntu.com/community/SwapFaq#What_is_swappiness_and_how_do_I_change_it.3F):

> По умолчанию в Ubuntu используется swappiness = 60. **Снижение значения swappiness по умолчанию, вероятно, улучшит общую производительность для типичной установки Ubuntu на рабочем столе. Значение swappiness = 10 рекомендуется**, но не стесняйтесь экспериментировать.

Изменяя это значение на 10 или даже на 0, вы можете добавить значительное и ощутимое увеличение скорости для более старой системы с медленным движением. Установка этого значения в 0 не отключает своп для ядра Linux 3.4 и ниже, но для 3.5+ это делает так, что вы захотите использовать значение 1, если хотите сохранить его на самом низком уровне \*.

Я не вижу причин не устанавливать это значение на 0, поскольку все, что попадает на диск, работает медленнее, чем ОЗУ. У меня есть 8 виртуальных ядер, быстрый SSD и 8 ГБ памяти, и подкачка установлена на 0. На данный момент у меня работает 3 виртуальные машины, мое использование памяти составляет 7,1 из 7,7 ГБ, файл подкачки составляет всего 576КБ от 952МБ и все системы работают без сбоев!

[From the Ubuntu SwapFAQ](https://help.ubuntu.com/community/SwapFaq#What_is_swappiness_and_how_do_I_change_it.3F):

> Параметр swappiness контролирует стремление ядра перемещать процессы из физической памяти на диск подкачки. Поскольку диски намного медленнее, чем ОЗУ, это может привести к более медленному времени отклика для системы и приложений, если процессы слишком агрессивно перемещаются из памяти.
> 
> 1.  swappiness может иметь значение от 0 до 100
> 2.  swappiness = 0 говорит ядру избегать выгрузки процессов из физической памяти как можно дольше
> 3.  swappiness = 100 говорит ядру агрессивно выгружать процессы из физической памяти и перемещать их в кеш подкачки

**Ниже приведены основные инструкции для проверки подкачки, очистки свопинга и изменения подмены на 0:**

Чтобы проверить значение перестановки:

```
cat /proc/sys/vm/swappiness

```

Временно установить своп на 0 ([как предложено SpamapS](https://askubuntu.com/questions/1357/how-to-empty-swap-if-there-is-free-ram/1359#1359)):

_Это очистит ваш своп и перенесет весь своп обратно в память. Сначала убедитесь, что у вас достаточно памяти, перейдя на вкладку ресурсов gnome-system-monitor, ваша свободная память должна быть больше используемой подкачки. Этот процесс может занять некоторое время, используйте gnome-system-monitor для мониторинга и проверки прогресса._

```
sudo swapoff --all

```

Чтобы установить новое значение на 0:

```
sudo sysctl vm.swappiness=0 

```

Чтобы снова включить своп:

```
sudo swapon --all

```

Чтобы навсегда установить swappiness на 0:

1.  `sudoedit /etc/sysctl.conf`
2.  Add this line`vm.swappiness = 0`
3.  `sudo shutdown -r now`\# restart system

\* В версии ядра 3.5+ установка swappiness на 0 действительно отключает его, и рекомендуется установить значение 1, если вы хотите использовать алгоритм наименьшей загрузки. источник: [https://www.percona.com/blog/2014/04/28/oom-relation-vm-swappiness0-new-kernel/](https://www.percona.com/blog/2014/04/28/oom-relation-vm-swappiness0-new-kernel/)

**********
[swap](/tags/swap.md)
[Ubuntu](/tags/Ubuntu.md)
