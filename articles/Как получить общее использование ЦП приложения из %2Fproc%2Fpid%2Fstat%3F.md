# Как получить общее использование ЦП приложения из /proc/pid/stat?

# Подготовка

Чтобы вычислить использование ЦП для конкретного процесса, вам понадобится следующее:

*   [`/proc/uptime`](http://man7.org/linux/man-pages/man5/proc.5.html)
    *   `#1`время работы системы (в секундах)
*   [`/proc/[PID]/stat`](http://man7.org/linux/man-pages/man5/proc.5.html)
    *   `#14 utime`\- время процессора, затрачиваемое на код пользователя, измеренное в тактовых импульсах
    *   `#15 stime`\- время процессора, затрачиваемое на код ядра, измеренное в тактовых импульсах
    *   `#16 cutime`\-**Ожидаемое детское**время процессора, затрачиваемое на код пользователя (в часах)
    *   `#17 cstime`\-**Ожидаемое детское**время процессора, затраченное на код ядра (в тактах синхронизации)
    *   `#22 starttime`\- время начала процесса, измеренное в тактовых импульсах
*   Hertz (количество тактов в секунду) вашей системы.
    *   В большинстве случаев[`getconf CLK_TCK`](http://pubs.opengroup.org/onlinepubs/009695399/utilities/getconf.html)может использоваться для возврата количества тактов.
    *   [`sysconf(_SC_CLK_TCK)`](http://pubs.opengroup.org/onlinepubs/009695399/functions/sysconf.html)Вызов функции C может также использоваться для возврата значения герца.

# Расчет

Сначала мы определяем общее время, затрачиваемое на процесс:

```
total_time = utime + stime

```

Мы также должны решить, хотим ли мы включить время от дочерних процессов. Если мы это сделаем, добавим эти значения в`total_time`:

```
total_time = total_time + cutime + cstime

```

Затем мы получаем общее время, прошедшее с момента запуска процесса:

```
seconds = uptime - (starttime / Hertz)

```

Наконец, мы вычисляем процент использования ЦП:

```
cpu_usage = 100 * ((total_time / Hertz) / seconds)
```